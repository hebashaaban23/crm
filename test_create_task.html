<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± create_task API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        .required {
            color: red;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .response.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .response.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .response pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            color: #004085;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .info-box ul {
            margin: 10px 0 0 20px;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin-top: 10px;
        }
        
        .loading.show {
            display: block;
        }
        
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± create_task API</h1>
        <p class="subtitle">Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
        
        <div class="info-box">
            <strong>â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©:</strong>
            <ul>
                <li>ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ <strong>https://trust.jossoor.org</strong></li>
                <li>ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ø£Ø­Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: Sales User, Sales Manager, Sales Master Manager, System Manager</li>
                <li>Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Session Cookie ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­</li>
            </ul>
        </div>
        
        <form id="taskForm">
            <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
            <div class="section">
                <div class="section-title">ğŸ“‹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
                
                <div class="form-group">
                    <label for="task_type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© <span class="required">*</span></label>
                    <select id="task_type" name="task_type" required>
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</option>
                        <option value="Meeting">Meeting</option>
                        <option value="Property Showing">Property Showing</option>
                        <option value="Call">Call</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                    <input type="text" id="title" name="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©">
                </div>
                
                <div class="two-columns">
                    <div class="form-group">
                        <label for="status">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select id="status" name="status">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                            <option value="Backlog">Backlog</option>
                            <option value="Todo" selected>Todo</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Done">Done</option>
                            <option value="late">late</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="priority">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="priority" name="priority">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</option>
                            <option value="Low">Low</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="High">High</option>
                        </select>
                    </div>
                </div>
                
                <div class="two-columns">
                    <div class="form-group">
                        <label for="start_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label>
                        <input type="datetime-local" id="start_date" name="start_date">
                    </div>
                    
                    <div class="form-group">
                        <label for="due_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                        <input type="datetime-local" id="due_date" name="due_date">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="description" name="description" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©"></textarea>
                </div>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¬Ø¹ -->
            <div class="section">
                <div class="section-title">ğŸ”— Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¬Ø¹</div>
                
                <div class="two-columns">
                    <div class="form-group">
                        <label for="lead">Lead (CRM Lead ID)</label>
                        <input type="text" id="lead" name="lead" placeholder="CRM-LEAD-2025-001">
                    </div>
                    
                    <div class="form-group">
                        <label for="project">Project (Real Estate Project ID)</label>
                        <input type="text" id="project" name="project" placeholder="PROJECT-001">
                    </div>
                </div>
                
                <div class="two-columns">
                    <div class="form-group">
                        <label for="unit">Unit (Unit ID)</label>
                        <input type="text" id="unit" name="unit" placeholder="UNIT-001">
                    </div>
                    
                    <div class="form-group">
                        <label for="project_unit">Project Unit (Project Unit ID)</label>
                        <input type="text" id="project_unit" name="project_unit" placeholder="PROJECT-UNIT-001">
                    </div>
                </div>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
            <div class="section">
                <div class="section-title">ğŸ‘¥ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†</div>
                
                <div class="form-group">
                    <label for="assigned_to">Assigned To (Email ÙˆØ§Ø­Ø¯ - legacy)</label>
                    <input type="email" id="assigned_to" name="assigned_to" placeholder="user@example.com">
                </div>
                
                <div class="form-group">
                    <label>Assigned To List (JSON Array)</label>
                    <textarea id="assigned_to_list" name="assigned_to_list" placeholder='[{"email": "user@example.com", "name": "User Name", "profile_pic": null}]'></textarea>
                    <small style="color: #666; font-size: 12px;">ØµÙŠØºØ© JSON: [{"email": "...", "name": "...", "profile_pic": null}]</small>
                </div>
                
                <div class="form-group">
                    <label>Meeting Attendees (JSON Array)</label>
                    <textarea id="meeting_attendees" name="meeting_attendees" placeholder='[{"email": "attendee@example.com", "name": "Attendee Name", "profile_pic": null}]'></textarea>
                    <small style="color: #666; font-size: 12px;">ØµÙŠØºØ© JSON: [{"email": "...", "name": "...", "profile_pic": null}]</small>
                </div>
            </div>
            
            <button type="submit" id="submitBtn">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Task</button>
            <div class="loading" id="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
        </form>
        
        <div class="response" id="response"></div>
    </div>
    
    <script>
        const form = document.getElementById('taskForm');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const responseDiv = document.getElementById('response');
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        const now = new Date();
        const today = now.toISOString().slice(0, 16);
        document.getElementById('start_date').value = today;
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            responseDiv.style.display = 'none';
            responseDiv.className = 'response';
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Loading
            submitBtn.disabled = true;
            loading.classList.add('show');
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const formData = new FormData(form);
            const data = {};
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            if (formData.get('task_type')) data.task_type = formData.get('task_type');
            if (formData.get('title')) data.title = formData.get('title');
            if (formData.get('status')) data.status = formData.get('status');
            if (formData.get('priority')) data.priority = formData.get('priority');
            if (formData.get('description')) data.description = formData.get('description');
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            if (formData.get('start_date')) {
                const startDate = new Date(formData.get('start_date'));
                data.start_date = startDate.toISOString().slice(0, 19).replace('T', ' ');
            }
            if (formData.get('due_date')) {
                const dueDate = new Date(formData.get('due_date'));
                data.due_date = dueDate.toISOString().slice(0, 19).replace('T', ' ');
            }
            
            // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¬Ø¹
            if (formData.get('lead')) data.lead = formData.get('lead');
            if (formData.get('project')) data.project = formData.get('project');
            if (formData.get('unit')) data.unit = formData.get('unit');
            if (formData.get('project_unit')) data.project_unit = formData.get('project_unit');
            
            // Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            if (formData.get('assigned_to')) data.assigned_to = formData.get('assigned_to');
            
            // Parse JSON fields
            try {
                if (formData.get('assigned_to_list')) {
                    const assignedToList = formData.get('assigned_to_list').trim();
                    if (assignedToList) {
                        data.assigned_to_list = JSON.parse(assignedToList);
                    }
                }
            } catch (e) {
                showError('Ø®Ø·Ø£ ÙÙŠ ØµÙŠØºØ© assigned_to_list JSON: ' + e.message);
                submitBtn.disabled = false;
                loading.classList.remove('show');
                return;
            }
            
            try {
                if (formData.get('meeting_attendees')) {
                    const meetingAttendees = formData.get('meeting_attendees').trim();
                    if (meetingAttendees) {
                        data.meeting_attendees = JSON.parse(meetingAttendees);
                    }
                }
            } catch (e) {
                showError('Ø®Ø·Ø£ ÙÙŠ ØµÙŠØºØ© meeting_attendees JSON: ' + e.message);
                submitBtn.disabled = false;
                loading.classList.remove('show');
                return;
            }
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            try {
                const response = await fetch('https://trust.jossoor.org/api/method/crm.api.mobile_api.create_task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include', // Ø§Ø³ØªØ®Ø¯Ø§Ù… cookies Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && !result.exc_type) {
                    showSuccess(result);
                } else {
                    showError(result);
                }
            } catch (error) {
                showError({
                    message: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„',
                    error: error.message
                });
            } finally {
                submitBtn.disabled = false;
                loading.classList.remove('show');
            }
        });
        
        function showSuccess(data) {
            responseDiv.className = 'response success';
            responseDiv.style.display = 'block';
            responseDiv.innerHTML = '<strong>âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Task Ø¨Ù†Ø¬Ø§Ø­!</strong><pre>' + JSON.stringify(data, null, 2) + '</pre>';
            responseDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function showError(data) {
            responseDiv.className = 'response error';
            responseDiv.style.display = 'block';
            let errorMsg = '';
            
            if (data.exception) {
                errorMsg = '<strong>âŒ Ø®Ø·Ø£:</strong><br>' + data.exception;
            } else if (data.message) {
                errorMsg = '<strong>âŒ Ø®Ø·Ø£:</strong><br>' + data.message;
            } else {
                errorMsg = '<strong>âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</strong>';
            }
            
            responseDiv.innerHTML = errorMsg + '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            responseDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>

